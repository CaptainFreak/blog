<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="OWASP Juice Shop Challenge Pack 2018This post is supposed to be a report of work done under the project “ChallengePack 2018” of Juice Shop which I did as Student Developer at OWASP as part of Google S">
<meta name="keywords" content="GSoC 2018,OWASP,Web-Security">
<meta property="og:type" content="article">
<meta property="og:title" content="OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)">
<meta property="og:url" content="https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/index.html">
<meta property="og:site_name" content="CaptainFreak">
<meta property="og:description" content="OWASP Juice Shop Challenge Pack 2018This post is supposed to be a report of work done under the project “ChallengePack 2018” of Juice Shop which I did as Student Developer at OWASP as part of Google S">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://media.giphy.com/media/26h0poAzDM5h8gHWE/giphy.gif">
<meta property="og:image" content="https://user-images.githubusercontent.com/20478531/41213943-094f86a4-6d66-11e8-807d-468b55fe5a40.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/20478531/41278766-4cf64522-6e48-11e8-9377-64c4ee653b49.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/20478531/42200313-45a46b28-7eb0-11e8-9239-5feffad0074f.jpg">
<meta property="og:image" content="https://media.giphy.com/media/HAonhTZTaQE24/giphy.gif">
<meta property="og:updated_time" content="2020-08-10T07:07:46.825Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)">
<meta name="twitter:description" content="OWASP Juice Shop Challenge Pack 2018This post is supposed to be a report of work done under the project “ChallengePack 2018” of Juice Shop which I did as Student Developer at OWASP as part of Google S">
<meta name="twitter:image" content="https://media.giphy.com/media/26h0poAzDM5h8gHWE/giphy.gif">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/CaptainFreak">Projects</a></li>
         
          <li><a href="/Search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/08/18/Google-Summer-of-Code-2018/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&text=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&title=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&is_video=false&description=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)&body=Check out this article: https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&title=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&title=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&title=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&title=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&name=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#OWASP-Juice-Shop-Challenge-Pack-2018"><span class="toc-number">1.</span> <span class="toc-text">OWASP Juice Shop Challenge Pack 2018</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Tests-For-“Old-School-XSS”-Challenge"><span class="toc-number">1.1.</span> <span class="toc-text">Tests For “Old-School XSS” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Lateral-Privilege-Escalation-Insecure-Direct-Object-Reference”-Challenge"><span class="toc-number">1.2.</span> <span class="toc-text">“Lateral Privilege Escalation/Insecure Direct Object Reference” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Vulnerable-Node-Module”-Challenge"><span class="toc-number">1.3.</span> <span class="toc-text">“Vulnerable Node Module” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Tier-3-NoSQL-Injection”-Challenge"><span class="toc-number">1.4.</span> <span class="toc-text">“Tier 3 NoSQL Injection” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“HTTP-Parameter-Pollution”-Challenge"><span class="toc-number">1.5.</span> <span class="toc-text">“HTTP Parameter Pollution” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“JSONP-XSSi”-Challenge"><span class="toc-number">1.6.</span> <span class="toc-text">“JSONP/XSSi” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Race-Condition-Timing-Attack”-Challenge"><span class="toc-number">1.7.</span> <span class="toc-text">“Race Condition/Timing Attack” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Mass-Assignement”-Challenge"><span class="toc-number">1.8.</span> <span class="toc-text">“Mass Assignement” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Exploit-Chain-1”-Challenge"><span class="toc-number">1.9.</span> <span class="toc-text">“Exploit Chain 1” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Server-Side-Template-Injection”-Challenge"><span class="toc-number">1.10.</span> <span class="toc-text">“Server Side Template Injection” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Server-Side-Request-Forgery”-Challenge"><span class="toc-number">1.11.</span> <span class="toc-text">“Server Side Request Forgery” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Abandoned-Postponed-Challenges"><span class="toc-number">1.12.</span> <span class="toc-text">Abandoned/Postponed Challenges</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Miscellaneous"><span class="toc-number">1.13.</span> <span class="toc-text">Miscellaneous</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Contributions-before-official-start-of-GSoC-2018"><span class="toc-number">2.</span> <span class="toc-text">Contributions before official start of GSoC-2018</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">CaptainFreak</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-08-04T18:33:29.000Z" itemprop="datePublished">2018-08-05</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/GSoC-2018/">GSoC 2018</a>, <a class="tag-link" href="/tags/OWASP/">OWASP</a>, <a class="tag-link" href="/tags/Web-Security/">Web-Security</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="OWASP-Juice-Shop-Challenge-Pack-2018"><a href="#OWASP-Juice-Shop-Challenge-Pack-2018" class="headerlink" title="OWASP Juice Shop Challenge Pack 2018"></a>OWASP Juice Shop Challenge Pack 2018</h1><p>This post is supposed to be a report of work done under the project <a href="https://summerofcode.withgoogle.com/projects/#6618613964865536" target="_blank" rel="noopener">“ChallengePack 2018”</a> of <a href="https://github.com/bkimminich/juice-shop" target="_blank" rel="noopener">Juice Shop</a> which I did as Student Developer at OWASP as part of <a href="https://summerofcode.withgoogle.com" target="_blank" rel="noopener">Google Summer of Code 2018</a>. For those who are unaware of what Juice Shop is, please do check it out. Its an intentionally kept vulnerable web application which aims to be a learning/practising resource for Web Developer as well as Web Security Enthusiasts. Instead of just making a dry report I will try to document the things that I learned while completing each task that was proposed. I hope it will benefit the future contributers/GSoC students of Juice Shop/WebDevelopers/Hackers as a documentation and will hold the information about what has been happening to Juice Shop over the course of Summer 2018. I will also show exactly which lines of code were made vulnerable to introduce each challenge. Before hand I would like to say that I am still a noob 🤷‍ and have no expertise in WebSecurity and Web Development, So if you feel that something is incorrect then I am totally open to positive criticism. Please comment your thoughts below :). So without further ado, Lets get this started.</p>
<p><img src="https://media.giphy.com/media/26h0poAzDM5h8gHWE/giphy.gif" alt=""></p>
<p>Under Google Summer of Code 2018, Juice Shop had two projects, One was my <code>Challenge Pack 2018</code> whose work is under <a href="https://github.com/bkimminich/juice-shop/tree/gsoc-challenges" target="_blank" rel="noopener">gsoc-challenges</a> branch and other project was <code>Frontend Upgrade</code> by <a href="https://github.com/Aashish683" target="_blank" rel="noopener">@Aashish</a> whose work is under <a href="https://github.com/bkimminich/juice-shop/tree/gsoc-frontend" target="_blank" rel="noopener">gsoc-frontend</a> branch. </p>
<h2 id="Tests-For-“Old-School-XSS”-Challenge"><a href="#Tests-For-“Old-School-XSS”-Challenge" class="headerlink" title="Tests For “Old-School XSS” Challenge"></a>Tests For “Old-School XSS” Challenge</h2><p>Previously (Before start of official coding phase of GSoC), I had designed and added the functionality of tracking user orders and challenge of “Reflected XSS” around it but Unit, Integration and E2E tests for the functinality and challenge were remaining because I was not very good at the test writing technologies of Juice Shop. This PR took quite a lot of time to get complete and merge but along the way I learned about those technologies and purpose of writing tests.</p>
<p>Link to PR : <a href="https://github.com/bkimminich/juice-shop/pull/567" target="_blank" rel="noopener">XSS Challenge Tests</a></p>
<h2 id="“Lateral-Privilege-Escalation-Insecure-Direct-Object-Reference”-Challenge"><a href="#“Lateral-Privilege-Escalation-Insecure-Direct-Object-Reference”-Challenge" class="headerlink" title="“Lateral Privilege Escalation/Insecure Direct Object Reference” Challenge"></a>“Lateral Privilege Escalation/Insecure Direct Object Reference” Challenge</h2><p>Although Juice Shop is meant to be fully vulnerable, this bug was unintentinal one and was reported by another user in an <a href="https://github.com/bkimminich/juice-shop/issues/538" target="_blank" rel="noopener">issue</a>. Any user was able to post product reviews as any user. The challenge got designed as to post a forged review as another user. It was kind of reassuring to see that even security aware developers can write vulnerable code and vulnerabilities will be always out there.</p>
<p>Link to PR : <a href="https://github.com/bkimminich/juice-shop/pull/572" target="_blank" rel="noopener">Forged Review</a><br>Vulnerable Code-Snippet :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">module.exports = function productReviews () &#123;</span><br><span class="line">  return (req, res, next) =&gt; &#123;</span><br><span class="line">  // No check of object ownership :)</span><br><span class="line">    db.reviews.insert(&#123;</span><br><span class="line">      product: req.params.id,</span><br><span class="line">      message: req.body.message,</span><br><span class="line">      author: req.body.author,</span><br><span class="line">      likesCount: 0,</span><br><span class="line">      likedBy: []</span><br><span class="line">    &#125;).then(result =&gt; &#123;</span><br><span class="line">      res.status(201).json(&#123; staus: &apos;success&apos; &#125;)</span><br><span class="line">    &#125;, err =&gt; &#123;</span><br><span class="line">      res.status(500).json(err)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="“Vulnerable-Node-Module”-Challenge"><a href="#“Vulnerable-Node-Module”-Challenge" class="headerlink" title="“Vulnerable Node Module” Challenge"></a>“Vulnerable Node Module” Challenge</h2><p>Node ecosystem heavily relies on node modules and a lot can go wrong if the modules you are using are vulnerable and outdated. This challenge got designed around the recent vulnerability disclosure called <a href="https://github.com/snyk/zip-slip-vulnerability" target="_blank" rel="noopener">Zip-Slip</a>. Archive extraction packages which are used for unzipping archives were allowing arbitrary file write at server-side. I added functionality of Multiple complaint submission through archive upload and designed the challenge of overwriting an important file of the Juice Shop. The hurdle we came upon was to properly sandbox this so that people using Juice Shop over local instance don’t overwrite the important files of their own system by mistake as crafting payload archive for this can result in mistakes because of black-box scenario. I solved it by checking absolute paths of files before extraction.</p>
<p><img src="https://user-images.githubusercontent.com/20478531/41213943-094f86a4-6d66-11e8-807d-468b55fe5a40.png" alt=""></p>
<p>Link to PR : <a href="https://github.com/bkimminich/juice-shop/pull/611" target="_blank" rel="noopener">Vulnerable node module</a><br>Vulnerable Code-Snippet :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;unzipper&quot;: &quot;0.8.12&quot;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="“Tier-3-NoSQL-Injection”-Challenge"><a href="#“Tier-3-NoSQL-Injection”-Challenge" class="headerlink" title="“Tier 3 NoSQL Injection” Challenge"></a>“Tier 3 NoSQL Injection” Challenge</h2><p>Juice Shop uses MarsDB as its NoSQL Database. After implementing the challenge of getting orders of all the users, I got quite a context about how and where this bug can happen in NoSQL Databases in general.</p>
<p>Link to PR : <a href="https://github.com/bkimminich/juice-shop/pull/577" target="_blank" rel="noopener">NoSQLi Tier 3</a><br>Vulnerable Code-Snippet :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.orders.find(&#123; $where: &quot;this.orderId === &apos;&quot; + req.params.id + &quot;&apos;&quot; &#125;).then()</span><br></pre></td></tr></table></figure></p>
<h2 id="“HTTP-Parameter-Pollution”-Challenge"><a href="#“HTTP-Parameter-Pollution”-Challenge" class="headerlink" title="“HTTP Parameter Pollution” Challenge"></a>“HTTP Parameter Pollution” Challenge</h2><p>HPP vulnerability primarily depends upon the reqest body parsers. In the case of Juice Shop, JSON parser was the default one which just takes the value of last paramater present. To implement this challenge I used different parser specifically for this challenge. Scenario of the challenge was very typical where the first occurance of paramater was used for validating but the value was taken for use from last occurance of the paramater in POST JSON body. Challenge was to succesfully edit other user’s basket.</p>
<p>Link to PR : <a href="https://github.com/bkimminich/juice-shop/pull/623" target="_blank" rel="noopener">HTTP Parameter Pollution</a><br>Vulnerable Code-Snippet :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">if (user &amp;&amp; basketIds[0] &amp;&amp; basketIds[0] !== &apos;undefined&apos; &amp;&amp; user.bid != basketIds[0]) &#123; // eslint-disable-line eqeqeq</span><br><span class="line">  res.status(401).send(&apos;&#123;\&apos;error\&apos; : \&apos;Invalid BasketId\&apos;&#125;&apos;)</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  const basketItem = &#123;</span><br><span class="line">    ProductId: productIds[productIds.length - 1],</span><br><span class="line">    BasketId: basketIds[basketIds.length - 1],      // Using value from second occurance bypasses the validation</span><br><span class="line">    quantity: quantities[quantities.length - 1]</span><br><span class="line">  &#125;</span><br><span class="line">  const basketItemInstance = models.BasketItem.build(basketItem)</span><br><span class="line">      basketItemInstance.save().then((basketItem) =&gt; &#123;</span><br><span class="line">        basketItem = &#123;</span><br><span class="line">          status: &apos;success&apos;,</span><br><span class="line">          data: basketItem</span><br><span class="line">        &#125;</span><br><span class="line">        res.json(basketItem)</span><br><span class="line">      &#125;).catch(err =&gt; &#123;</span><br><span class="line">        next(err)</span><br><span class="line">      &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="“JSONP-XSSi”-Challenge"><a href="#“JSONP-XSSi”-Challenge" class="headerlink" title="“JSONP/XSSi” Challenge"></a>“JSONP/XSSi” Challenge</h2><p>Even though Juice Shop doesn’t have an actual use case for JSONP because it is just one application running on single domain but for making it a complete learning resource, I added JSONP on an endpoint which returns user’s personal information wrapped up in a function whose name is decided by a <code>GET</code> parameter called <code>callback</code>. The challenge was to guess/bruteforce for this JSONP endpoint.</p>
<p>Link to PR : <a href="https://github.com/bkimminich/juice-shop/pull/627" target="_blank" rel="noopener">JSONP</a><br>Vulnerable Code-Snippet :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">module.exports = function retrieveLoggedInUser () &#123;</span><br><span class="line">  return (req, res) =&gt; &#123;</span><br><span class="line">    const user = insecurity.authenticatedUsers.from(req)</span><br><span class="line">    const response = &#123; user: &#123; id: (user &amp;&amp; user.data ? user.data.id : undefined), email: (user &amp;&amp; user.data ? user.data.email : undefined) &#125; &#125;</span><br><span class="line">    if (req.query.callback === undefined) &#123;</span><br><span class="line">      res.json(response)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      res.jsonp(response)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="“Race-Condition-Timing-Attack”-Challenge"><a href="#“Race-Condition-Timing-Attack”-Challenge" class="headerlink" title="“Race Condition/Timing Attack” Challenge"></a>“Race Condition/Timing Attack” Challenge</h2><p>This was my favorite challenge to implement because of its complexity and unavailability in any other vulnerable application (as far as I know). Juice Shop can not have race condition bug naturally because it uses MarsDB and it has no reason of having that much observable latency. So we had to add that artificially. Vulnerability and Challenge structure was like following :</p>
<p><img src="https://user-images.githubusercontent.com/20478531/41278766-4cf64522-6e48-11e8-9377-64c4ee653b49.png" alt=""></p>
<p>Link to PR : <a href="https://github.com/bkimminich/juice-shop/pull/617" target="_blank" rel="noopener">Race Condition/Timing Attack</a><br>Link to Vulnerable Code-Snippet :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/bkimminich/juice-shop/pull/617/files#diff-fb4c8fba3911529be7878d2553b1fed1</span><br></pre></td></tr></table></figure></p>
<h2 id="“Mass-Assignement”-Challenge"><a href="#“Mass-Assignement”-Challenge" class="headerlink" title="“Mass Assignement” Challenge"></a>“Mass Assignement” Challenge</h2><p>Mass assignment Vulnerability is very prevalent in web technologies where request’s body is mapped to objects directly using some library etc. In Juice Shop the users can become admin while signing up by adding an ingeniosly guessed extra parameter called <code>isAdmin</code> by looking at reponses. which gets mapped to database column without any check and users get admin privileges.</p>
<p>Link to PR : <a href="https://github.com/bkimminich/juice-shop/pull/629" target="_blank" rel="noopener">Mass Assignement</a><br>Link to Vulnerable Code-Snippet :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/bkimminich/juice-shop/pull/629/files#diff-45182e43f88790a0b1fdc8479ebb66b1</span><br></pre></td></tr></table></figure></p>
<h2 id="“Exploit-Chain-1”-Challenge"><a href="#“Exploit-Chain-1”-Challenge" class="headerlink" title="“Exploit Chain 1” Challenge"></a>“Exploit Chain 1” Challenge</h2><p>From the start I wanted to add a cool vulnerability chain in the Juice Shop. The exploit chain was supposed to be a chain of Login CSRF paired with Self XSS where XSS payload was sent through <code>True-Client-IP</code> header. But due to Juice Shop’s solution checking mechanism and standalone nature, We decided to convert the chain to simple XSS.</p>
<p><img src="https://user-images.githubusercontent.com/20478531/42200313-45a46b28-7eb0-11e8-9239-5feffad0074f.jpg" alt=""></p>
<p>Link to PR : <a href="https://github.com/bkimminich/juice-shop/pull/632" target="_blank" rel="noopener">Exploit Chain 1</a><br>Vulnerable Code-Snippet :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$rootScope.lastLoginIp = $sce.trustAsHtml(user.lastLoginIp)</span><br></pre></td></tr></table></figure></p>
<p><em>As you can see, Even adding XSS intentionally in angular apps is tough. So my advice to all hunters, As soon as you see target is using angular, stop spraying XSS payloads.</em></p>
<h2 id="“Server-Side-Template-Injection”-Challenge"><a href="#“Server-Side-Template-Injection”-Challenge" class="headerlink" title="“Server Side Template Injection” Challenge"></a>“Server Side Template Injection” Challenge</h2><p>This was one of my another favorite challenge to add. Initially Juice Shop used Client side rendering and was totally secure to SSTi. For adding this challenge I added the user profile page which was rendered using the jade template engine. Username field was made vulnerable to SSTi. SSTi is basically RCE for modern application which use Server Side template engine. To make this new RCE bug more cool, <a href="https://twitter.com/j12934" target="_blank" rel="noopener">@Jannik</a> suggested a very cool challenge around it which involved exploiting this RCE to infect the Juice Shop server with malware. Yep 😎 ! </p>
<p>Link to PR : <a href="https://github.com/bkimminich/juice-shop/pull/655" target="_blank" rel="noopener">Server Side Template Injection</a> Yet to be merged.<br>Vulnerable Code-Snippet :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">templateString = templateString.replace(&apos;usrname&apos;, user.dataValues.username)</span><br><span class="line">var fn = jade.compile(templateString)</span><br><span class="line">res.send(fn(user.dataValues))</span><br></pre></td></tr></table></figure></p>
<h2 id="“Server-Side-Request-Forgery”-Challenge"><a href="#“Server-Side-Request-Forgery”-Challenge" class="headerlink" title="“Server Side Request Forgery” Challenge"></a>“Server Side Request Forgery” Challenge</h2><p>SSRF is a critical vulnerability if attacker is able to pivot into internal network of the target. As Juice Shop being a standalone application, doesn’t have it. So a very basic version of SSRF was implemented around the functinality of image upload using URL. The challenge gets solved when you request a hidden resource of Juice Shop server. The hidden resource is supposed to be obtained from the malware of SSTI challenge 😁.</p>
<p>Link to PR : <a href="https://github.com/bkimminich/juice-shop/pull/655" target="_blank" rel="noopener">Server Side Request Forgery</a> Yet to be merged.<br>Vulnerable Code-Snippet :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">module.exports = function profileImageUrlUpload () &#123;</span><br><span class="line">  return (req, res, next) =&gt; &#123;</span><br><span class="line">	  	var url = req.body.imageUrl</span><br><span class="line">		request</span><br><span class="line">		.get(url)   // Requesting without any check</span><br><span class="line">		.on(&apos;error&apos;, function (err) &#123;</span><br><span class="line">		console.log(err)</span><br><span class="line">		&#125;)</span><br><span class="line">		.pipe(fs.createWriteStream(&apos;frontend/dist/frontend/assets/public/images/uploads/&apos; + loggedInUser.data.id + &apos;.jpg&apos;))</span><br><span class="line">	&#125;</span><br><span class="line">    res.location(&apos;/profile&apos;)</span><br><span class="line">    res.redirect(&apos;/profile&apos;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<h2 id="Abandoned-Postponed-Challenges"><a href="#Abandoned-Postponed-Challenges" class="headerlink" title="Abandoned/Postponed Challenges"></a>Abandoned/Postponed Challenges</h2><ol>
<li>ImageTragick Challenge<br> The reason behind abandoning this challenge was that it required a vulnerable imagemagick binary to be installed on users personal system which might cause big concerns regarding safety of users systems.</li>
<li>Angular Template Injection Challenge</li>
<li>Facebook Oauth Challenge<br> I planned to add this challenge as soon as the SSTi-SSRF PR gets merged.</li>
</ol>
<h2 id="Miscellaneous"><a href="#Miscellaneous" class="headerlink" title="Miscellaneous"></a>Miscellaneous</h2><p>Apart from working on challenge pack, I also helped fix some of the broken functinalities after the major merging of <code>Frontend Upgrade</code> project into <code>Challenge Pack</code>. This was quite time taking as only @Aashish knew about the new frontend codebase. But this frontend technology upgrade was very much required for Juice Shop as it aims to properly be like modern JS web applications.</p>
<h1 id="Contributions-before-official-start-of-GSoC-2018"><a href="#Contributions-before-official-start-of-GSoC-2018" class="headerlink" title="Contributions before official start of GSoC-2018"></a>Contributions before official start of GSoC-2018</h1><hr>
<ol>
<li><a href="https://github.com/bkimminich/juice-shop/pull/480" target="_blank" rel="noopener">CAPTCHA on feedbackform and Challenge</a></li>
<li><a href="https://github.com/bkimminich/juice-shop/pull/460" target="_blank" rel="noopener">Easter Egg Customization</a></li>
<li><a href="https://github.com/bkimminich/juice-shop/pull/452" target="_blank" rel="noopener">Rate Limiting and its circumventionn challenge</a></li>
<li><a href="https://github.com/bkimminich/juice-shop/pull/444" target="_blank" rel="noopener">Customization in Product Tampering Challenge</a></li>
<li><a href="https://github.com/bkimminich/juice-shop/pull/500" target="_blank" rel="noopener">Order Tracking Dashboard</a></li>
</ol>
<hr>
<p>Hope you learnt something new after reading this. If you haven’t already read my <a href="https://blog.shoebpatel.me/2018/08/18/Google-Summer-of-Code-2018/" target="_blank" rel="noopener"><code>Google Summer of Code 2018</code></a> blog then please read it ☝.<br>I had very good learning experience while working for OWASP Juice Shop. I will recommend every student who loves web security and developement to contribute to the Juice Shop Project.</p>
<p>Thanks for reading the blog post.<br>GodSpeed and Happy Hacking 😎.</p>
<p><img src="https://media.giphy.com/media/HAonhTZTaQE24/giphy.gif" alt=""></p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/CaptainFreak">Projects</a></li>
         
          <li><a href="/Search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#OWASP-Juice-Shop-Challenge-Pack-2018"><span class="toc-number">1.</span> <span class="toc-text">OWASP Juice Shop Challenge Pack 2018</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Tests-For-“Old-School-XSS”-Challenge"><span class="toc-number">1.1.</span> <span class="toc-text">Tests For “Old-School XSS” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Lateral-Privilege-Escalation-Insecure-Direct-Object-Reference”-Challenge"><span class="toc-number">1.2.</span> <span class="toc-text">“Lateral Privilege Escalation/Insecure Direct Object Reference” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Vulnerable-Node-Module”-Challenge"><span class="toc-number">1.3.</span> <span class="toc-text">“Vulnerable Node Module” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Tier-3-NoSQL-Injection”-Challenge"><span class="toc-number">1.4.</span> <span class="toc-text">“Tier 3 NoSQL Injection” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“HTTP-Parameter-Pollution”-Challenge"><span class="toc-number">1.5.</span> <span class="toc-text">“HTTP Parameter Pollution” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“JSONP-XSSi”-Challenge"><span class="toc-number">1.6.</span> <span class="toc-text">“JSONP/XSSi” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Race-Condition-Timing-Attack”-Challenge"><span class="toc-number">1.7.</span> <span class="toc-text">“Race Condition/Timing Attack” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Mass-Assignement”-Challenge"><span class="toc-number">1.8.</span> <span class="toc-text">“Mass Assignement” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Exploit-Chain-1”-Challenge"><span class="toc-number">1.9.</span> <span class="toc-text">“Exploit Chain 1” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Server-Side-Template-Injection”-Challenge"><span class="toc-number">1.10.</span> <span class="toc-text">“Server Side Template Injection” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“Server-Side-Request-Forgery”-Challenge"><span class="toc-number">1.11.</span> <span class="toc-text">“Server Side Request Forgery” Challenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Abandoned-Postponed-Challenges"><span class="toc-number">1.12.</span> <span class="toc-text">Abandoned/Postponed Challenges</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Miscellaneous"><span class="toc-number">1.13.</span> <span class="toc-text">Miscellaneous</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Contributions-before-official-start-of-GSoC-2018"><span class="toc-number">2.</span> <span class="toc-text">Contributions before official start of GSoC-2018</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&text=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&title=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&is_video=false&description=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)&body=Check out this article: https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&title=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&title=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&title=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&title=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://blog.shoebpatel.com/2018/08/05/OWASP-Juice-Shop-Challenge-Pack-2018-GSoC-project-report/&name=OWASP Juice Shop : Challenge Pack 2018 (GSoC project report)&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 CaptainFreak
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/About/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/CaptainFreak">Projects</a></li>
         
          <li><a href="/Search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-113860447-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'captainfreaks-infosec-blog';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


